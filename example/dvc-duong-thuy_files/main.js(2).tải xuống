AUI.add("liferay-plugin-dockbar-notifications",function(a){var b=a.Component.create({AUGMENTS:[Liferay.PortletBase],EXTENDS:a.Base,NAME:"dockbarnotifications",prototype:{initializer:function(e){var c=this;c._actionableNotificationsList=e.actionableNotificationsList;c._baseActionURL=e.baseActionURL;c._baseResourceURL=e.baseResourceURL;c._nonActionableNotificationsList=e.nonActionableNotificationsList;c._portletKey=e.portletKey;var f=a.one(".dockbar-user-notifications");f.on("click",function(i){var k=i.target;if(k.ancestor(".dockbar-user-notifications-container")){return}c._setDelivered();var j=i.currentTarget;var g=j.one(".dockbar-user-notifications-container");g.toggleClass("open");var h=g.hasClass("open");if(h){j.on("clickoutside",function(l){g.removeClass("open")});c._nonActionableNotificationsList.render()}});var d=a.one(".user-notification-close");d.on("click",function(i){var j=i.target;if(j.ancestor(".dockbar-user-notifications-container")){var g=j.ancestor(".dockbar-user-notifications-container");var h=g.hasClass("open");if(h){g.removeClass("open");c._nonActionableNotificationsList.render()}}});a.on("domready",function(){Liferay.Poller.addListener(c._portletKey,c._onPollerUpdate,c)});Liferay.on("updateNotificationsCount",c._getNotificationsCount,c)},_getNotificationsCount:function(){var c=this;var d=new Liferay.PortletURL.createURL(c._baseResourceURL);d.setResourceId("getNotificationsCount");a.io.request(d.toString(),{dataType:"JSON",on:{success:function(){var e=this.get("responseData");if(e){var f=e.newUserNotificationsCount;var g=e.timestamp;var h=e.unreadUserNotificationsCount;c._updateDockbarNotificationsCount(f,g,h)}}}})},_onPollerUpdate:function(d){var c=this;c._updateDockbarNotificationsCount(d.newUserNotificationsCount,d.timestamp,d.unreadUserNotificationsCount)},_setDelivered:function(){},_updateDockbarNotificationsCount:function(d,f,g){var c=this;if(!c._previousTimestamp||(c._previousTimestamp<f)){c._previousTimestamp=f;var e=a.one(".dockbar-user-notifications .user-notifications-count");if(e){e.toggleClass("alert",(d>0));e.setHTML(g)}}}}});Liferay.DockbarNotifications=b},"",{requires:["aui-base","aui-io","liferay-poller","liferay-portlet-base","liferay-portlet-url"]});AUI.add("liferay-plugin-notifications-list",function(a){var c=a.Lang;var b=a.Component.create({AUGMENTS:[Liferay.PortletBase],EXTENDS:a.Base,NAME:"notificationslist",prototype:{initializer:function(e){var d=this;d._actionable=e.actionable;d._baseActionURL=e.baseActionURL;d._baseRenderURL=e.baseRenderURL;d._baseResourceURL=e.baseResourceURL;d._namespace=e.namespace;d._notificationsContainer=e.notificationsContainer;d._unreadNotificationsCount=e.unreadNotificationsCount;d._notificationsNode=e.notificationsNode;d._portletKey=e.portletKey;d._delta=e.delta;d._end=e.start+e.delta;d._start=e.start;d._paginationInfoNode=e.paginationInfoNode;d._previousPageNode=e.previousPageNode;d._nextPageNode=e.nextPageNode;d._fullView=e.fullView;d._markAllAsReadNode=e.markAllAsReadNode;d._bindUI()},getStart:function(){},render:function(){var d=this;var g=a.one(d._notificationsContainer);var e=g.one(d._notificationsNode);e.plug(a.LoadingMask);e.loadingmask.show();var f=new Liferay.PortletURL.createURL(d._baseResourceURL);f.setResourceId("getUserNotificationEvents");a.io.request(f.toString(),{dataType:"JSON",on:{success:function(){var k=this.get("responseData");if(k){var p=k.total;var l=g.one(d._unreadNotificationsCount);if(l){l.setHTML(p)}var j=[];var h=k.entries;if(h){for(var m=0;m<h.length;m++){j.push(h[m])}j=j.join("")}var o=(h.length>0);if(!o){var n='\u0042\u1ea1\u006e\u0020\u006b\u0068\u00f4\u006e\u0067\u0020\u0063\u00f3\u0020\u0074\u0068\u00f4\u006e\u0067\u0020\u0062\u00e1\u006f\u0020\u006d\u1edb\u0069\u0020\u006e\u00e0\u006f';e.setHTML('<div class="message">'+n+"</div>")}else{e.setHTML(j)}d._unreadUserNotificationEventIds=k.unreadUserNotificationEventIds;e.loadingmask.hide()}}}});Liferay.fire("updateNotificationsCount")},setActionable:function(d){},setUnreadNotificationsCount:function(e){var d=this;d._unreadNotificationsCount=e},setStart:function(d){},_bindMarkAllAsRead:function(){},_bindMarkAsRead:function(){var d=this;console.log("run _bindMarkAsRead()");var f=a.one(d._notificationsContainer);var e=f.one(d._notificationsNode);if(e){e.delegate("click",function(j){var k=j.currentTarget;var h=k.ancestor(".user-notification");h.plug(a.LoadingMask);h.loadingmask.show();var i=h.one(".user-notification-link");var g=i.attr("data-markAsReadURL");if(g){a.io.request(g,{after:{success:function(){var l=this.get("responseData");if(l.success){h.loadingmask.hide();d.render()}}},dataType:"JSON"})}},".user-notification .mark-as-read")}},_bindNextPageNotifications:function(){},_bindNotificationsAction:function(){},_bindPreviousPageNotifications:function(){},_bindUI:function(){var d=this;d._bindViewNotification()},_bindViewNotification:function(){var d=this;var f=a.one(d._notificationsContainer);var e=f.one(d._notificationsNode);if(e){e.delegate("click",function(i){var k=i.currentTarget;var j=i.target;var h=k.attr("data-href");var g=k.attr("data-markAsReadURL");if(g){a.io.request(g,{after:{success:function(){var l=this.get("responseData");if(l.success){d._redirect(h)}}},dataType:"JSON"})}else{d._redirect(h)}},".user-notification .user-notification-link")}},_openWindow:function(d){return/p_p_state=(maximized|pop_up|exclusive)/.test(d)},_redirect:function(f){var d=this;console.log("uri:"+f);if(f){if(d._openWindow(f)){Liferay.Util.openWindow({id:"notificationsWindow",uri:f})}else{var e=Liferay.Util.getTop();e.location.href=f}}}}});Liferay.NotificationsList=b},"",{requires:["aui-base","aui-io","aui-loading-mask-deprecated","liferay-poller","liferay-portlet-base","liferay-portlet-url"]});AUI.add("mark-as-read",function(a){var b=a.Component.create({AUGMENTS:[Liferay.PortletBase],EXTENDS:a.Base,NAME:"markasread",prototype:{initializer:function(d){var c=this;c._notificationsContainer=d.notificationsContainer;c._notificationsNode=d.notificationsNode;c._notificationsLinkClass=d.notificationsLinkClass;c._bindViewNotification()},_bindViewNotification:function(){var c=this;var f=a.one(c._notificationsContainer);var e=c._notificationsLinkClass;if(f){var d=f.one(c._notificationsNode)}if(d){d.delegate("click",function(i){var k=i.currentTarget;var j=i.target;var h=k.attr("data-href");var g=k.attr("data-markasreadurl");if(g){a.io.request(g,{after:{success:function(){var l=this.get("responseData");if(l.success){c._redirect(h)}}},dataType:"JSON"})}else{c._redirect(h)}},e)}},_redirect:function(e){var c=this;console.log("markasread_uri:"+e);if(e){if(c._openWindow(e)){Liferay.Util.openWindow({id:"notificationsWindow",uri:e})}else{var d=Liferay.Util.getTop();d.location.href=e}}},_openWindow:function(c){return/p_p_state=(maximized|pop_up|exclusive)/.test(c)}}});Liferay.MarkAsRead=b},"",{requires:["aui-base","aui-io","liferay-portlet-url"]});